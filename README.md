# Project Title
ZK-Circuit-Implementation

## Description

Using the [hardhat-circom](https://github.com/projectsophon/hardhat-circom) template to generate zero-knowledge circuits, proofs, 
and solidity verifiers. This program implements the following logical gate, with the goal to prove knowledge of the inputs A (0) 
& B (1) that yield a 0 output.
```
Logical gate:
'A' and 'B' are the two input signals to the circuit.
The result of computing the 'AND' of 'A' and 'B' is stored in the 'X' signal.

'X' and 'Y' are two internal signals used to store intermediate values.
The result of computing the 'NOT' of 'B' is stored in the 'Y' signal.

'Q' is the output signal from the circuit.
The result of computing the 'OR' of 'X' and 'Y' is stored in the 'Q' signal
```

## Quick Start
Compile the crafteradesdeskcircuit() circuit and verify it against a smart contract verifier

```
pragma circom 2.0.0;

/*This circuit implementation builds upon the hardhat-circum template by zardkat proves knowledge of the inputs A (0) & B (1) that
yield a 0 output.*/  

template CrafterAdesdeskCircuit() {  
   
   // signal inputs
   signal input a;
   signal input b;

   // signals from gates
   signal x;
   signal y;

   // final signal outputs
   signal output q;

   // component gates used to create CrafterAdesdeskCircuit circuit  
   component andGate = AND();
   component notGate = NOT();
   component orGate = OR();

   // circuit logic
   andGate.a <== a;
   andGate.b <== b;
   x <== andGate.out;

   notGate.in <== b;
   y <== notGate.out;

   orGate.a <== x;
   orGate.b <== y;
   q <== orGate.out;

}

template AND() {
    signal input a;
    signal input b;
    signal output out;

    out <== a*b;
}

template OR() {
    signal input a;
    signal input b;
    signal output out;

    out <== a + b - a*b;
}

template NOT() {
    signal input in;
    signal output out;

    out <== 1 + in - 2*in;
}
component main = CrafterAdesdeskCircuit();
```
### Install
`npm i`

### Compile
`npx hardhat circom` 
This will generate the **out** file with circuit intermediaries and geneate the **CrafterAdesdeskCircuit.sol** contract

### Prove and Deploy
`npx hardhat run scripts/deploy.ts`
This script does 4 things  
1. Deploys the crafteradesdeskcircuit.sol contract
2. Generates a proof from circuit intermediaries with `generateProof()`
3. Generates calldata with `generateCallData()`
4. Calls `verifyProof()` on the verifier contract with calldata

With two commands you can compile a ZKP, generate a proof, deploy a verifier, and verify the proof ðŸŽ‰

## Configuration
### Directory Structure
**circuits**
```
â”œâ”€â”€ crafteradesdeskcircuit
â”‚   â”œâ”€â”€ circuit.circom
â”‚   â”œâ”€â”€ input.json
â”‚   â””â”€â”€ out
â”‚       â”œâ”€â”€ circuit.wasm
â”‚       â”œâ”€â”€ crafteradesdeskcircuit.r1cs
â”‚       â”œâ”€â”€ crafteradesdeskcircuit.vkey
â”‚       â””â”€â”€ crafteradesdeskcircuit.zkey
â”œâ”€â”€ new-circuit
â””â”€â”€ powersOfTau28_hez_final_12.ptau
```
Each new circuit lives in it's own directory. At the top level of each circuit directory lives the circom circuit and input to the circuit.
The **out** directory will be autogenerated and store the compiled outputs, keys, and proofs. The Powers of Tau file comes from the Polygon Hermez ceremony, which saves time by not needing a new ceremony. 


**contracts**
```
contracts
â””â”€â”€ CrafterAdesdeskCircuit.sol
```
Verifier contracts are autogenerated and prefixed by the circuit name, in this project **CrafterAdesdeskCircuit**

## hardhat.config.ts
```
  circom: {
    // (optional) Base path for input files, defaults to `./circuits/`
    inputBasePath: "./circuits",
    // (required) The final ptau file, relative to inputBasePath, from a Phase 1 ceremony
    ptau: "powersOfTau28_hez_final_12.ptau",
    // (required) Each object in this array refers to a separate circuit
    circuits: JSON.parse(JSON.stringify(circuits))
  },
```
### circuits.config.json
circuits configuation is separated from hardhat.config.ts for **autogenerated** purposes (see next section)
```
[
  {
    "name": "crafteradesdeskcircuit",
    "protocol": "groth16",
    "circuit": "crafteradesdeskcircuit/circuit.circom",
    "input": "crafteradesdeskcircuit/input.json",
    "wasm": "crafteradesdeskcircuit/out/circuit.wasm",
    "zkey": "crafteradesdeskcircuit/out/crafteradesdeskcircuit.zkey",
    "vkey": "crafteradesdeskcircuit/out/crafteradesdeskcircuit.vkey",
    "r1cs": "crafteradesdeskcircuit/out/crafteradesdeskcircuit.r1cs",
    "beacon": "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f"
  }
]
```

**adding circuits**   
To add a new circuit, you can run the `newcircuit` hardhat task to autogenerate configuration and directories i.e  
```
npx hardhat newcircuit --name newcircuit
```

**determinism**
> When you recompile the same circuit using the groth16 protocol, even with no changes, this plugin will apply a new final beacon, changing all the zkey output files. This also causes your Verifier contracts to be updated.
> For development builds of groth16 circuits, we provide the --deterministic flag in order to use a NON-RANDOM and UNSECURE hardcoded entropy (0x000000 by default) which will allow you to more easily inspect and catch changes in your circuits. You can adjust this default beacon by setting the beacon property on a circuit's config in your hardhat.config.js file.

## Author(s)

Contributor(s) names and contact info

Name: Adeola David Adelakun

Email: adesdesk@outlook.com

## License
This project is licensed under the MIT License - see the LICENSE.md file for details

##### Verifier deployed to Polygon Mumbai address: 0x29f7A980Eb09774Ad540ab49d80932EBbF89bb00
